% s filter to rule out the background
% method: otsu algorithm 
function I_class_out = Crab_Extract(I_class)
Level = graythresh(I_class.S) % make use of otsu algorithm to rule out the background
I_class_out = I_class;
I_crab_template = im2bw(I_class.S, level);
% rule out the bolb to narrow
for i=1:height
    for j=1:width
        if(I_crab_template(i, j) == 1)
            if( sum(I_crab_template(i, max(j-5, 1):min(j+5, I_class.Width))) <= 5 )
                I_crab_template(i, j) = 0;
            end
            if( sum(I_crab_template(max(ii-8, 1):min(ii+8, I_class.Height), j)) <= 8)
                I_crab_template(i, j) = 0;
            end
        end
    end
end
%find the largest one
I_S_binary_area_handle = regionprops(I_crab_template, 'area');
for i = 1:length(I_S_binary_area_handle)
    I_S_area(ii) = I_S_binary_area_handle(i)
    
      